<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeJudge Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
            color: #1a1a1a;
        }

        .theme-selector {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .problem-panel {
            width: 50%;
            background: white;
            border-right: 1px solid #e1e5e9;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .problem-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .problem-title h2 {
            font-size: 1.25rem;
            color: #1a1a1a;
        }

        .difficulty-badge {
            background: #d1fae5;
            color: #065f46;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .problem-description {
            color: #374151;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .examples-section h3,
        .results-section h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: #1a1a1a;
        }

        .example {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .example-line {
            margin-bottom: 0.5rem;
        }

        .code-highlight {
            background: #e5e7eb;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
        }

        .editor-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .language-selector {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .submit-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .submit-btn:hover:not(:disabled) {
            background: #1d4ed8;
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .editor-container {
            flex: 1;
            background: #f3f4f6;
            padding: 1rem;
        }

        .monaco-container {
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .results-section {
            margin-top: 2rem;
        }

        .result-summary {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
        }

        .status-accepted {
            color: #059669;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .status-failed {
            color: #dc2626;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .metrics {
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .test-case {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .test-case-passed {
            background: #ecfdf5;
            color: #065f46;
        }

        .test-case-failed {
            background: #fef2f2;
            color: #991b1b;
        }

        .test-case-details {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            font-family: 'Courier New', monospace;
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CodeJudge Platform</h1>
        <select class="theme-selector" id="themeSelector">
            <option value="vs-dark">Dark Theme</option>
            <option value="vs">Light Theme</option>
        </select>
    </div>

    <div class="main-container">
        <div class="problem-panel">
            <div class="problem-title">
                <h2>Two Sum</h2>
                <span class="difficulty-badge">Easy</span>
            </div>

            <div class="problem-description">
                Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target. You may assume that each input would have exactly one solution, and you may not use the same element twice.
            </div>

            <div class="examples-section">
                <h3>Examples</h3>
                <div class="example">
                    <div class="example-line"><strong>Input:</strong> <span class="code-highlight">nums = [2,7,11,15], target = 9</span></div>
                    <div class="example-line"><strong>Output:</strong> <span class="code-highlight">[0,1]</span></div>
                    <div class="example-line"><strong>Explanation:</strong> Because nums[0] + nums[1] == 9, we return [0, 1].</div>
                </div>
                <div class="example">
                    <div class="example-line"><strong>Input:</strong> <span class="code-highlight">nums = [3,2,4], target = 6</span></div>
                    <div class="example-line"><strong>Output:</strong> <span class="code-highlight">[1,2]</span></div>
                </div>
            </div>

            <div class="results-section hidden" id="resultsSection">
                <h3>Submission Result</h3>
                <div class="result-summary" id="resultSummary">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>

        <div class="editor-panel">
            <div class="editor-header">
                <select class="language-selector" id="languageSelector">
                    <option value="python">Python 3</option>
                    <option value="javascript">JavaScript</option>
                    <option value="java">Java</option>
                    <option value="cpp">C++</option>
                </select>
                <button class="submit-btn" id="submitBtn">
                    <span>▶</span>
                    <span id="submitText">Submit</span>
                </button>
            </div>
            <div class="editor-container">
                <div class="monaco-container" id="editor"></div>
            </div>
        </div>
    </div>

    <script>
        // Language configurations
        const LANGUAGES = {
            python: {
                id: 71,
                name: 'Python 3',
                template: `def twoSum(nums, target):
    """
    :type nums: List[int]
    :type target: int
    :rtype: List[int]
    """
    # Your solution here
    pass`
            },
            javascript: {
                id: 63,
                name: 'JavaScript',
                template: `/**
 * @param {number[]} nums
 * @param {number} target
 * @return {number[]}
 */
var twoSum = function(nums, target) {
    // Your solution here
};`
            },
            java: {
                id: 62,
                name: 'Java',
                template: `class Solution {
    public int[] twoSum(int[] nums, int target) {
        // Your solution here
        return new int[]{};
    }
}`
            },
            cpp: {
                id: 54,
                name: 'C++',
                template: `class Solution {
public:
    vector<int> twoSum(vector<int>& nums, int target) {
        // Your solution here
        return {};
    }
};`
            }
        };

        // Test cases
        const TEST_CASES = [
            { input: "[2,7,11,15]\n9", expectedOutput: "[0,1]" },
            { input: "[3,2,4]\n6", expectedOutput: "[1,2]" },
            { input: "[3,3]\n6", expectedOutput: "[0,1]" }
        ];

        let editor;
        let currentLanguage = 'python';

        // Initialize Monaco Editor and load problem data
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: LANGUAGES.python.template,
                language: 'python',
                theme: 'vs-dark',
                fontSize: 14,
                minimap: { enabled: false },
                wordWrap: 'on',
                automaticLayout: true,
                scrollBeyondLastLine: false
            });

            // Load problem data from Django API
            loadProblem();
        });

        // Django API integration
        async function submitCodeToDjango(code, language, problemSlug = 'two-sum') {
            try {
                const response = await fetch('/api/submit/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'), // Django CSRF token
                    },
                    body: JSON.stringify({
                        code: code,
                        language: language,
                        problem_slug: problemSlug
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Transform Django response to match frontend expectations
                return {
                    status: data.results.status,
                    results: data.results.test_results,
                    totalRuntime: data.results.total_runtime,
                    totalMemory: data.results.total_memory
                };
            } catch (error) {
                console.error('Submission failed:', error);
                throw error;
            }
        }

        // Helper function to get Django CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Load problem data from Django
        async function loadProblem(slug = 'two-sum') {
            try {
                const response = await fetch(`/api/problems/${slug}/`);
                if (response.ok) {
                    const problem = await response.json();
                    updateProblemDisplay(problem);
                }
            } catch (error) {
                console.error('Failed to load problem:', error);
            }
        }

        function updateProblemDisplay(problem) {
            // Update problem title and difficulty
            document.querySelector('.problem-title h2').textContent = problem.title;
            document.querySelector('.difficulty-badge').textContent = problem.difficulty.charAt(0).toUpperCase() + problem.difficulty.slice(1);

            // Update description
            document.querySelector('.problem-description').textContent = problem.description;

            // Update examples if provided
            if (problem.examples && problem.examples.length > 0) {
                const examplesContainer = document.querySelector('.examples-section');
                const existingExamples = examplesContainer.querySelectorAll('.example');
                existingExamples.forEach(ex => ex.remove());

                problem.examples.forEach(example => {
                    const exampleDiv = document.createElement('div');
                    exampleDiv.className = 'example';
                    exampleDiv.innerHTML = `
                        <div class="example-line"><strong>Input:</strong> <span class="code-highlight">${example.input}</span></div>
                        <div class="example-line"><strong>Output:</strong> <span class="code-highlight">${example.output}</span></div>
                        ${example.explanation ? `<div class="example-line"><strong>Explanation:</strong> ${example.explanation}</div>` : ''}
                    `;
                    examplesContainer.appendChild(exampleDiv);
                });
            }
        }

        // Event listeners
        document.getElementById('languageSelector').addEventListener('change', function(e) {
            currentLanguage = e.target.value;
            const template = LANGUAGES[currentLanguage].template;
            editor.setValue(template);
            monaco.editor.setModelLanguage(editor.getModel(), currentLanguage === 'cpp' ? 'cpp' : currentLanguage);
        });

        document.getElementById('themeSelector').addEventListener('change', function(e) {
            monaco.editor.setTheme(editor, e.target.value);
        });

        document.getElementById('submitBtn').addEventListener('click', async function() {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const resultsSection = document.getElementById('resultsSection');

            // Disable button and show loading
            submitBtn.disabled = true;
            submitText.innerHTML = '<span class="loading"></span> Submitting...';
            resultsSection.classList.add('hidden');

            try {
                const code = editor.getValue();
                const result = await submitCodeToDjango(code, currentLanguage);
                displayResults(result);
            } catch (error) {
                console.error('Submission failed:', error);
                // Show error message to user
                const resultSummary = document.getElementById('resultSummary');
                const resultsSection = document.getElementById('resultsSection');
                resultSummary.innerHTML = `
                    <div class="status-failed">
                        <span>✗</span>
                        Submission Failed
                    </div>
                    <div style="color: #dc2626; margin-top: 0.5rem;">
                        ${error.message || 'An error occurred during submission'}
                    </div>
                `;
                resultsSection.classList.remove('hidden');
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitText.textContent = 'Submit';
            }
        });

        function displayResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const resultSummary = document.getElementById('resultSummary');

            const statusClass = result.status === 'Accepted' ? 'status-accepted' : 'status-failed';
            const statusIcon = result.status === 'Accepted' ? '✓' : '✗';

            let testCasesHTML = '';
            result.results.forEach(testResult => {
                const testClass = testResult.passed ? 'test-case-passed' : 'test-case-failed';
                testCasesHTML += `
                    <div class="test-case ${testClass}">
                        <div class="font-medium">Test Case ${testResult.testCase}: ${testResult.passed ? 'Passed' : 'Failed'}</div>
                        ${!testResult.passed ? `
                            <div class="test-case-details">
                                <div>Expected: ${testResult.expectedOutput}</div>
                                <div>Got: ${testResult.actualOutput}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            resultSummary.innerHTML = `
                <div class="${statusClass}">
                    <span>${statusIcon}</span>
                    ${result.status}
                </div>
                <div class="metrics">
                    <span>⏱ Runtime: ${result.totalRuntime}</span>
                    <span>⚡ Memory: ${result.totalMemory}</span>
                </div>
                <div>
                    ${testCasesHTML}
                </div>
            `;

            resultsSection.classList.remove('hidden');
        }

        // Real Judge0 integration example
        /*
        async function submitToJudge0(code, languageId, testCases) {
            const submissions = [];

            for (const testCase of testCases) {
                const response = await fetch('http://your-judge0-instance/submissions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        source_code: btoa(code),
                        language_id: languageId,
                        stdin: btoa(testCase.input),
                        expected_output: btoa(testCase.expectedOutput)
                    })
                });

                const { token } = await response.json();
                submissions.push(token);
            }

            // Poll for results
            const results = [];
            for (const token of submissions) {
                const result = await pollSubmissionResult(token);
                results.push(result);
            }

            return results;
        }

        async function pollSubmissionResult(token) {
            let result;
            do {
                await new Promise(resolve => setTimeout(resolve, 1000));
                const response = await fetch(`http://your-judge0-instance/submissions/${token}`);
                result = await response.json();
            } while (result.status.id <= 2); // 1: In Queue, 2: Processing

            return result;
        }
        */
    </script>
</body>
</html>